{{ partial "check-parameters.html" (dict
  "name" "partials/eventViews.html"
  "parameters" .
  "requiredParameters" (slice "pages" "default_timezone" "long")
  "optionalParameters" (slice )
)}}
{{ $pages := .pages }}
{{ $default_timezone := .default_timezone }}
{{ $long := .long }}

{{$events := partial "getEventsForPages.html" (dict
  "pages" $pages
  "default_timezone" $default_timezone
)}}

{{if $events }}
  {{/* separating in upcoming and past events; note, this is compared to buildtime, and only used if JS fails */}}
  {{ $now := now }}
  {{ $past := sort (where $events ".startDateTime" "<" $now) ".startDateTime" "desc" }}
{{ $future := where $events "startDateTime" ">=" $now }}
<div class="eventDates upcoming{{if $long}} long{{end}}">
  <div class="grid-tab upcoming">{{ site.Params.events.upcoming }}</div>
    <div class="grid-tab past">{{ site.Params.events.past }}</div>
    <div class="grid-tab calendar">{{ site.Params.events.calendar }}</div>
    <div class="grid-body upcoming">
      {{ partial "eventList.html" (dict "events" $future "long" $long) }}
    </div>
    <div class="grid-body past">
      {{ partial "eventList.html" (dict "events" $past "long" $long) }}
    </div>
    <div class="grid-body calendar">If you see this message, Javascript failed to build the calendar</div>
  </div>

  {{ .Scratch.Set "eventViews" true }}
  {{ $js := resources.Get "js/eventViews.ts" | js.Build }}
  <script src="{{ $js.RelPermalink }}">
  </script>
{{ end }}
